<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="box">
<title>Migration guide • box</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Migration guide">
<meta property="og:description" content="box">
<meta property="og:image" content="http://klmr.me/box/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">box</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/box.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>General topics</h6>
    <a class="dropdown-item" href="../articles/faq.html">Frequently asked questions</a>
    <a class="dropdown-item" href="../articles/testing.html">Testing modules</a>
    <a class="dropdown-item" href="../articles/compiled-code.html">Using compiled code</a>
    <a class="dropdown-item" href="../articles/migration.html">Migration guide for version 1.0</a>
    <a class="dropdown-item" href="../articles/related.html">Similar packages</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Implementation details</h6>
    <a class="dropdown-item" href="../articles/contributing.html">Contributing</a>
    <a class="dropdown-item" href="../articles/mod-env-hierarchy.html">The hierarchy of module environments</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/klmr/box/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Migration guide</h1>
                        <h4 data-toc-skip class="author">Konrad
Rudolph</h4>
            
            <h4 data-toc-skip class="date">2024-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/klmr/box/blob/main/vignettes/migration.rmd" class="external-link"><code>vignettes/migration.rmd</code></a></small>
      <div class="d-none name"><code>migration.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="modules-v1-0-box">‘modules’ “v1.0” == ‘box’<a class="anchor" aria-label="anchor" href="#modules-v1-0-box"></a>
</h2>
<p>‘box’ is the spiritual successor of the <a href="https://github.com/klmr/modules" class="external-link">‘modules’ package</a>, which will
forever remain at version 0.9.<em>x</em>. However, the API of ‘box’
intentionally breaks backwards compatibility, and module code written
for use with ‘modules’ will no longer work with ‘box’.</p>
<p>The following guide is intended to ease migration to ‘box’.
<strong>Migration is strongly recommended</strong>, since the authors
believe that ‘modules’ had conceptual shortcomings that have been fixed
in ‘box’, and to keep the ecosystem consolidated. For the time being,
‘modules’ will receive support (only) in the form of critical bug
fixes.</p>
</div>
<div class="section level2">
<h2 id="importing-modules-and-packages">Importing modules and packages<a class="anchor" aria-label="anchor" href="#importing-modules-and-packages"></a>
</h2>
<div class="section level3">
<h3 id="general-syntax">General syntax<a class="anchor" aria-label="anchor" href="#general-syntax"></a>
</h3>
<p>With the ‘modules’ package, modules and packages were imported
via</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wahani/modules" class="external-link">modules</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># …</span></span>
<span></span>
<span><span class="va">modname</span> <span class="op">=</span> <span class="fu">import</span><span class="op">(</span><span class="st">'prefix/modname'</span><span class="op">)</span></span>
<span><span class="va">pkgname</span> <span class="op">=</span> <span class="fu">import_package</span><span class="op">(</span><span class="st">'pkgname'</span><span class="op">)</span></span></code></pre></div>
<p>With ‘box’, modules and packages are imported via <a href="https://klmr.me/box/reference/use.html" class="external-link"><code>box::use</code></a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">prefix</span><span class="op">/</span><span class="va">modname</span><span class="op">)</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">pkgname</span><span class="op">)</span></span></code></pre></div>
<p>Notably, module and package names in a use declaration in ‘box’ are
unquoted, unevaluated expressions; and <strong>the ‘box’ package is
never loaded via <code>library</code></strong>. In fact,
<code><a href="https://klmr.me/box/" class="external-link">library(box)</a></code> raises an error.</p>
<p>Furthermore, with ‘box’, module names <em>must</em> be fully
qualified. The equivalent of the ‘modules’ code
<code>mod = import('modname')</code> no longer exists. To import a
<em>local</em> module without namespace prefix, instead use</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="va">modname</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/use.html">box::use</a></code> has no return value. Instead, it automatically
creates an alias with the module/package name in the calling scope
<em>if no names are attached</em> (see below). To override the alias
name, specify it as as a named argument:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span>mod_alias <span class="op">=</span> <span class="va">prefix</span><span class="op">/</span><span class="va">modname</span><span class="op">)</span></span></code></pre></div>
<p>Unlike with <code>modules::import</code>, <code><a href="../reference/use.html">box::use</a></code>
allows (and encourages) multiple use declarations at once:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span></span>
<span>    <span class="va">prefix</span><span class="op">/</span><span class="va">mod1</span>,</span>
<span>    mod <span class="op">=</span> <span class="va">prefix</span><span class="op">/</span><span class="va">mod2</span>,</span>
<span>    <span class="va">pkg</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="attaching-names">Attaching names<a class="anchor" aria-label="anchor" href="#attaching-names"></a>
</h3>
<p>In ‘modules’, the <code>attach</code> and
<code>attach_operators</code> parameters controlled if and which names
were attached. In ‘box’, attachment is controlled via attach list
declarations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ‘modules’:</span></span>
<span><span class="fu">import</span><span class="op">(</span><span class="st">'prefix/mod'</span>, attach <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'name1'</span>, <span class="st">'name2'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ‘box’:</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">prefix</span><span class="op">/</span><span class="va">mod</span><span class="op">[</span><span class="va">name1</span>, <span class="va">name2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Wildcard attach lists are also supported:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ‘modules’:</span></span>
<span><span class="fu">import</span><span class="op">(</span><span class="st">'prefix/mod'</span>, attach <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ‘box’:</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">prefix</span><span class="op">/</span><span class="va">mod</span><span class="op">[</span><span class="va">...</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>To introduce a module/package alias when attaching names, specify an
alias name:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ‘modules’:</span></span>
<span><span class="va">mod</span> <span class="op">=</span> <span class="fu">import</span><span class="op">(</span><span class="st">'prefix/mod'</span>, attach <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'name1'</span>, <span class="st">'name2'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ‘box’:</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="va">prefix</span><span class="op">/</span><span class="va">mod</span><span class="op">[</span><span class="va">name1</span>, <span class="va">name2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>‘box’ also allows declaring aliases for attached names; this feature
did not exist in ‘modules’:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Declare alias for one name, attach other name unchanged:</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">prefix</span><span class="op">/</span><span class="va">mod</span><span class="op">[</span>name_alias <span class="op">=</span> <span class="va">name1</span>, <span class="va">name2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Declare alias for two names, attach all other exported names unchanged:</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">prefix</span><span class="op">/</span><span class="va">mod</span><span class="op">[</span>name_alias1 <span class="op">=</span> <span class="va">name1</span>, name_alias2 <span class="op">=</span> <span class="va">name2</span>, <span class="va">...</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The <code>attach_operators</code> option from ‘modules’ has been
dropped. If users require operators, they need to explicitly attach them
when using ‘box’.</p>
</div>
<div class="section level3">
<h3 id="loading-documentation">Loading documentation<a class="anchor" aria-label="anchor" href="#loading-documentation"></a>
</h3>
<p>The <code>doc</code> option from <code>modules::import</code> has
been dropped without replacement. ‘box’ loads documentation lazily only
when it is requested via <code><a href="../reference/help.html">box::help</a></code> (see below).</p>
</div>
</div>
<div class="section level2">
<h2 id="executing-code-during-module-loading">Executing code during module loading<a class="anchor" aria-label="anchor" href="#executing-code-during-module-loading"></a>
</h2>
<p>The ‘modules’ package treated modules as regular R source code files:
upon importing them, the entire code inside a module file was executed.
‘box’ conceptually no longer does this. It regards module source code as
<em>declarative</em>: the module source code defines a number of names
to be exported. However, code with side-effects on the module file level
is no longer guaranteed to execute.</p>
<p>Instead, ‘box’ introduces <a href="https://klmr.me/box/reference/mod-hooks.html" class="external-link">module event
hooks</a>, in particular <code>.on_load</code>, which is a function that
gets executed whenever a module is first loaded inside an R session.</p>
</div>
<div class="section level2">
<h2 id="changed-options">Changed options<a class="anchor" aria-label="anchor" href="#changed-options"></a>
</h2>
<p>In ‘modules’, the module search path was set via
<code>options('import.path')</code>. In ‘box’, use
<code>options('box.path')</code> instead.</p>
<p>The ‘modules’ options <code>options('import.attach')</code> and
<code>options('warn.conflicts')</code> no longer exist. In particular,
‘box’ no longer warns of name conflicts when attaching names. Instead,
it encourages consciously choosing which names to attach.</p>
</div>
<div class="section level2">
<h2 id="changed-function-names">Changed function names<a class="anchor" aria-label="anchor" href="#changed-function-names"></a>
</h2>
<p>The ‘modules’ function <code>module_file</code> is now called <a href="https://klmr.me/box/reference/file.html" class="external-link"><code>box::file</code></a>.
Its semantics have also changed: it no longer cares whether files
relative to the module exist or not; it merely constructs appropriate
path strings.</p>
<p>The ‘module’ function <code>module_name</code> is now called <a href="https://klmr.me/box/reference/name.html" class="external-link"><code>box::name</code></a>.
It no longer has any arguments.</p>
</div>
<div class="section level2">
<h2 id="exporting-names-from-modules">Exporting names from modules<a class="anchor" aria-label="anchor" href="#exporting-names-from-modules"></a>
</h2>
<p>With the ‘modules’ packages, module source files exported all
non-hidden names; that is, all names that didn’t start with a dot
(<code>.</code>).</p>
<p>‘box’ makes exporting explicit. By default, <em>no</em> names are
exported from a module, unless they are marked with the directive
comment <code>#' @export</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This function is not exported:</span></span>
<span><span class="va">f1</span> <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># This nested module is not exported</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="va">nested1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This function is exported:</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">f2</span> <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># This nested module is exported</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="va">nested2</span><span class="op">)</span></span></code></pre></div>
<p><code>@export</code> directives that decorate <code><a href="../reference/use.html">box::use</a></code>
declarations apply to <em>all</em> names declared in it:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span></span>
<span>    pkg_alias <span class="op">=</span> <span class="va">pkg</span>,</span>
<span>    <span class="va">prefix</span><span class="op">/</span><span class="va">mod</span>,</span>
<span>    <span class="va">prefix</span><span class="op">/</span><span class="va">mod2</span><span class="op">[</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The above code will export the names <code>pkg_alias</code>,
<code>mod</code>, <code>a</code>, <code>b</code> and <code>c</code>.
This replaces the function <code>export_submodule</code> from ‘modules’,
which no longer exists.</p>
<p>There’s one exception to this: if a module contains <em>no</em>
declared export, ‘box’ assumes that it is a plain R script, and treats
it as a <em>legacy module</em>. This causes ‘box’ to revert to the
export behaviour of ‘modules’. To suppress this behaviour (that is, to
create a module which explicitly doesn’t export any names), module
authors can add the following declaration to their module source code,
which explicitly declares that the source file is to be treated as a
module with no exports:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-default-packages">Accessing default packages<a class="anchor" aria-label="anchor" href="#accessing-default-packages"></a>
</h2>
<p>In ‘modules’, module source code “sees” the package search path at
the time it is loaded. That is, modules have implicit access to all
names in packages that were attached when the module was loaded. In
particular, this means that legacy modules could access names in the
default packages (in non-interactive sessions, that’s typically
‘datasets’, ‘utils’, ‘grDevices’, ‘graphics’ and ‘stats’; in interactive
sessions, the package ‘methods’ is added).</p>
<p>‘box’ modules no longer attach <em>any</em> packages by default,
except ‘base’. If a module needs to use functions from those other
packages, it needs to declare them explicitly (e.g. via
<code>box::use(stats)</code>). If users want to import all default R
packages, they can import the module <code>r/core</code> for this
purpose. The following declaration approximates the behaviour of
‘modules’:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">r</span><span class="op">/</span><span class="va">core</span><span class="op">[</span><span class="va">...</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-parents-of-nested-modules">Loading parents of nested modules<a class="anchor" aria-label="anchor" href="#loading-parents-of-nested-modules"></a>
</h2>
<p>Consider the following file hierarchy defining a nested module:</p>
<pre><code><b>a</b>
├─ <i>__init__.r</i>
╰─ <b>b</b>
   ├─ <i>__init__.r</i>
   ╰─ <i><b>c</b>.r</i></code></pre>
<p>In ‘modules’, the declaration <code>import(a/b/c)</code> would import
the module <code>c</code>, but this would first execute the code of the
modules <code>a</code> and <code>a/b</code>. In other words it would
source the files <code>a/__init__.r</code>, <code>a/b/__init__.r</code>,
and <code>a/b/c.r</code>, in this order.</p>
<p>‘box’ no longer loads the full module hierarchy:
<code>box::use(a/b/c)</code> loads only the module defined by
<code>a/b/c.r</code>. Likewise, <code>box::use(a/b)</code> does
<em>not</em> automatically load <code>a/b/c.r</code> (but the same
behaviour was already present in ‘modules’).</p>
</div>
<div class="section level2">
<h2 id="displaying-documentation">Displaying documentation<a class="anchor" aria-label="anchor" href="#displaying-documentation"></a>
</h2>
<p>‘modules’ overrode the <code>help</code> function and the
<code>?</code> operator to allow displaying module documentation. Since
‘box’ is no longer attached, these functions no longer display module
documentation. Instead, the documentation of anything imported via
‘box’ (both modules and packages!) can be queried via <a href="https://klmr.me/box/reference/help.html" class="external-link"><code>box::help</code></a>.</p>
<p>Unlike ‘modules’, ‘box’ also supports displaying the documentation of
nested module names, e.g. <code>box::help(a$b$c)</code>.</p>
</div>
<div class="section level2">
<h2 id="cyclic-imports">Cyclic imports<a class="anchor" aria-label="anchor" href="#cyclic-imports"></a>
</h2>
<p>Cyclic/circular imports are supported by both ‘modules’ and ‘box’.
However, the level of support differs. The details are complicated, and
it is generally recommended to avoid cyclic modules. However, there are
some situations where circularity in the dependencies makes sense, and
‘box’ strives to make this work, where technically possible.</p>
<p>For instance, consider the following (nonsensical) working, circular
definition of the functions <code>even</code> and <code>odd</code>,
which determine whether a non-negative integer is even or odd:</p>
<ul>
<li>
<p><code>even.r</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="va">odd</span><span class="op">[</span><span class="va">...</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">even</span> <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n</span> <span class="op">==</span> <span class="fl">0L</span> <span class="op">||</span> <span class="op">!</span> <span class="fu">odd</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
<li>
<p><code>odd.r</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="va">even</span><span class="op">[</span><span class="va">...</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">odd</span> <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n</span> <span class="op">!=</span> <span class="fl">0L</span> <span class="op">&amp;&amp;</span> <span class="fu">even</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
</ul>
<p>These modules compute <code>even</code> in terms of <code>odd</code>,
and vice-versa. Yet ‘box’ has no trouble importing and using both these
modules. However, this no longer works once we attempt to export
imported submodules themselves. That is, the following version of
<code>odd.r</code> would cause an error:</p>
<ul>
<li>
<p><code>odd.r</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="../reference/use.html">use</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="va">even</span><span class="op">[</span><span class="va">...</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">odd</span> <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n</span> <span class="op">!=</span> <span class="fl">0L</span> <span class="op">&amp;&amp;</span> <span class="fu">even</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://klmr.me" class="external-link">Konrad Rudolph</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
